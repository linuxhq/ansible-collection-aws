---
- name: Ensure ec2 vpc igw role is tested
  hosts: localhost
  connection: local
  vars:
    ec2_vpc_net_list:
      - name: linuxhq-test
        cidr_block: 10.0.0.0/16

    ec2_vpc_igw_list:
      - name: linuxhq-test
        vpc_id: "{{ _ec2_vpc_net_info_dict['linuxhq-test'].id }}"

  roles:
    - linuxhq.aws.ec2_vpc_net
    - linuxhq.aws.ec2_vpc_igw

  post_tasks:
    - name: Ensure ec2 vpc lists are formatted
      ansible.builtin.set_fact:
        ec2_vpc_net_list:
          "{{ ec2_vpc_net_list |
              map('combine', {'state': 'absent'}) }}"
        ec2_vpc_igw_list:
          "{{ ec2_vpc_igw_list |
              map('combine', {'state': 'absent'}) }}"

    - name: Ensure ec2 vpc igw role is imported
      ansible.builtin.import_role:
        name: linuxhq.aws.ec2_vpc_igw

    - name: Ensure ec2 vpc net role is imported
      ansible.builtin.import_role:
        name: linuxhq.aws.ec2_vpc_net
...
